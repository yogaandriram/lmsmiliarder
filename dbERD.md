//// ------------------------------------------------------
//// Auto-generated by Gemini from a Markdown schema.
//// Schema for: Learning Management System (LMS)
//// Version 2.0: Ebooks and Courses as separate products.
//// ------------------------------------------------------

// Enum Definitions
Enum user_role {
admin
mentor
member
}

Enum verification_status {
pending
approved
rejected
}

Enum course_status {
draft
published
archived
}

Enum product_type {
course
ebook
}

Enum question_type {
multiple_choice
essay
}

Enum discount_type {
percentage
fixed
}

Enum payment_status {
pending
success
failed
}

// Table Definitions

//// 1. Core Pengguna & Autentikasi

Table users {
id bigint [pk, increment, note: 'ID unik untuk setiap pengguna.']
name varchar [not null, note: 'Nama lengkap pengguna.']
email varchar [unique, not null, note: 'Alamat email pengguna, digunakan untuk login.']
password varchar [not null, note: 'Kata sandi yang sudah di-hash.']
avatar_url varchar [note: 'URL ke foto profil pengguna.']
bio text [note: 'Deskripsi singkat tentang pengguna.']
role user_role [not null, note: 'Peran pengguna dalam sistem.']
email_verified_at timestamp [note: 'Penanda waktu kapan email diverifikasi.']
created_at timestamp [not null, note: 'Waktu pendaftaran.']
updated_at timestamp [not null, note: 'Waktu terakhir profil diubah.']
}

Table otp_verifications {
id bigint [pk, increment]
user_id bigint [not null, note: 'Pengguna yang meminta OTP.']
otp_code varchar [not null, note: 'Kode OTP yang di-generate.']
expires_at timestamp [not null, note: 'Waktu kedaluwarsa kode OTP.']
created_at timestamp [not null]
}

Table mentor_verifications {
id bigint [pk, increment]
user_id bigint [not null, note: 'Calon mentor yang mengajukan.']
document_url varchar [not null, note: 'URL ke dokumen pendukung (misal: CV, sertifikat).']
status verification_status [not null, note: 'Status verifikasi.']
notes text [note: 'Catatan dari admin terkait verifikasi.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

//// 2. Manajemen Konten & Kursus

Table categories {
id int [pk, increment]
name varchar [unique, not null, note: 'Nama kategori (misal: "Pemrograman Web").']
slug varchar [unique, not null, note: 'Versi URL-friendly dari nama.']
description text [note: 'Deskripsi singkat kategori.']
}

Table tags {
id int [pk, increment]
name varchar [unique, not null, note: 'Nama tag (misal: "PHP", "Laravel").']
slug varchar [unique, not null, note: 'Versi URL-friendly dari nama.']
}

Table courses {
id bigint [pk, increment]
author_id bigint [not null, note: 'Mentor/Author yang membuat kursus.']
category_id int [not null, note: 'Kategori dari kursus ini.']
title varchar [not null, note: 'Judul kursus.']
slug varchar [unique, not null, note: 'URL-friendly dari judul.']
description text [not null, note: 'Deskripsi lengkap kursus.']
thumbnail_url varchar [note: 'URL gambar thumbnail kursus.']
price decimal [not null, note: 'Harga kursus.']
status course_status [not null, note: 'Status publikasi kursus.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

Table course_tag {
course_id bigint [ref: > courses.id]
tag_id int [ref: > tags.id]

Indexes {
(course_id, tag_id) [pk]
}
}

Table modules {
id bigint [pk, increment]
course_id bigint [not null, note: 'Kursus induk dari modul ini.']
title varchar [not null, note: 'Judul modul.']
"order" int [not null, note: 'Urutan modul dalam kursus.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

Table lessons {
id bigint [pk, increment]
module_id bigint [not null, note: 'Modul induk dari materi ini.']
title varchar [not null, note: 'Judul materi.']
content longtext [not null, note: 'Isi materi pelajaran (bisa HTML atau Markdown).']
video_url varchar [note: 'URL video jika ada.']
"order" int [not null, note: 'Urutan materi dalam modul.']
duration_minutes int [note: 'Estimasi durasi materi.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

Table ebooks {
id bigint [pk, increment]
author_id bigint [not null, note: 'Penulis E-book.']
title varchar [not null, note: 'Judul e-book.']
slug varchar [unique, not null, note: 'URL-friendly dari judul.']
description text [not null, note: 'Deskripsi E-book.']
cover_image_url varchar [note: 'URL gambar sampul.']
file_url varchar [not null, note: 'URL untuk mengunduh file e-book.']
price decimal [not null, note: 'Harga E-book.']
status course_status [not null, note: 'Status publikasi E-book.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

//// 3. Kuis & Evaluasi

Table quizzes {
id bigint [pk, increment]
lesson_id bigint [not null, note: 'Materi terkait kuis ini.']
title varchar [not null, note: 'Judul kuis.']
description text [note: 'Instruksi atau deskripsi kuis.']
time_limit_minutes int [note: 'Batas waktu pengerjaan.']
created_at timestamp [not null]
}

Table quiz_questions {
id bigint [pk, increment]
quiz_id bigint [not null, note: 'Kuis induk dari pertanyaan ini.']
question_text text [not null, note: 'Isi pertanyaan.']
question_type question_type [not null, note: 'Jenis pertanyaan.']
"order" int [not null, note: 'Urutan pertanyaan.']
}

Table quiz_options {
id bigint [pk, increment]
question_id bigint [not null]
option_text text [not null, note: 'Teks pilihan jawaban.']
is_correct boolean [not null, note: 'Penanda apakah ini jawaban yang benar.']
}

Table user_quiz_attempts {
id bigint [pk, increment]
user_id bigint [not null]
quiz_id bigint [not null]
score float [note: 'Nilai akhir yang didapat.']
started_at timestamp [not null]
completed_at timestamp [note: 'Waktu selesai mengerjakan.']
}

//// 4. Interaksi & Komunitas

Table discussion_groups {
id bigint [pk, increment]
course_id bigint [unique, not null, note: 'Setiap kursus hanya punya satu grup diskusi.']
group_name varchar [not null, note: 'Nama grup (biasanya sama dengan nama kursus).']
created_at timestamp [not null]
}

Table discussion_threads {
id bigint [pk, increment]
group_id bigint [not null]
user_id bigint [not null, note: 'Pembuat thread.']
title varchar [not null, note: 'Judul topik diskusi.']
content text [not null, note: 'Isi postingan pertama.']
is_pinned boolean [not null, default: false, note: 'Untuk menandai topik penting.']
created_at timestamp [not null]
}

Table discussion_replies {
id bigint [pk, increment]
thread_id bigint [not null]
user_id bigint [not null, note: 'Pengirim balasan.']
parent_reply_id bigint [note: 'Untuk balasan berantai (nested).']
content text [not null, note: 'Isi balasan.']
created_at timestamp [not null]
}

Table announcements {
id bigint [pk, increment]
admin_id bigint [not null, note: 'Admin yang membuat pengumuman.']
title varchar [not null]
content text [not null]
created_at timestamp [not null]
}

Table notifications {
id char(36) [pk, note: 'Menggunakan UUID agar unik.']
recipient_id bigint [not null, note: 'Pengguna penerima notifikasi.']
message varchar [not null, note: 'Isi pesan notifikasi.']
link_url varchar [note: 'URL tujuan saat notifikasi diklik.']
read_at timestamp [note: 'Penanda sudah dibaca.']
created_at timestamp [not null]
}

//// 5. Transaksi & Manajemen Member

Table admin_bank_accounts {
id bigint [pk, increment]
bank_name varchar [not null, note: 'Nama bank, misal: BCA, Mandiri.']
account_number varchar [not null, note: 'Nomor rekening.']
account_holder_name varchar [not null, note: 'Nama pemilik rekening.']
is_active boolean [not null, default: true, note: 'Status aktif rekening.']
created_at timestamp [not null]
updated_at timestamp [not null]
}

Table coupons {
id bigint [pk, increment]
code varchar [unique, not null, note: 'Kode kupon unik.']
discount_type discount_type [not null, note: 'Jenis diskon.']
discount_value decimal [not null, note: 'Nilai diskon.']
expires_at timestamp [not null, note: 'Tanggal kedaluwarsa kupon.']
usage_limit int [note: 'Batas penggunaan kupon.']
is_active boolean [not null, default: true]
}

Table transactions {
id bigint [pk, increment]
user_id bigint [not null, note: 'Pengguna yang melakukan transaksi.']
coupon_id bigint [note: 'Kupon yang digunakan.']
admin_bank_account_id bigint [note: 'Rekening tujuan untuk transfer manual.']
total_amount decimal [not null, note: 'Jumlah total sebelum diskon.']
discount_amount decimal [not null, default: 0, note: 'Jumlah diskon.']
final_amount decimal [not null, note: 'Jumlah yang harus dibayar.']
payment_method varchar [note: "Metode pembayaran (misal: 'manual_transfer', 'credit_card')."]
payment_proof_url varchar [note: 'URL bukti pembayaran yang diunggah pengguna.']
payment_status payment_status [not null]
transaction_time timestamp [not null]
}

Table transaction_details {
id bigint [pk, increment]
transaction_id bigint [not null]
product_type product_type [not null, note: 'Menandakan apakah item ini Course atau Ebook']
course_id bigint [note: 'Diisi jika product_type adalah "course"']
ebook_id bigint [note: 'Diisi jika product_type adalah "ebook"']
price decimal [not null, note: 'Harga produk saat transaksi.']

note: 'Hanya satu dari course_id atau ebook_id yang boleh diisi per baris.'
}

Table enrollments {
id bigint [pk, increment]
user_id bigint [not null]
course_id bigint [not null]
enrolled_at timestamp [not null]

Indexes {
(user_id, course_id) [unique, note: 'Mencegah pendaftaran ganda.']
}
}

Table user_ebook_library {
id bigint [pk, increment]
user_id bigint [not null]
ebook_id bigint [not null]
purchased_at timestamp [not null]

Indexes {
(user_id, ebook_id) [unique, note: 'Mencegah user membeli ebook yang sama berulang kali.']
}
}

Table learning_progress {
id bigint [pk, increment]
enrollment_id bigint [not null]
lesson_id bigint [not null]
completed_at timestamp [note: 'Penanda materi selesai.']
updated_at timestamp [not null]
}

// Relationships
Ref: otp_verifications.user_id > users.id
Ref: mentor_verifications.user_id > users.id
Ref: courses.author_id > users.id
Ref: courses.category_id > categories.id
Ref: ebooks.author_id > users.id
Ref: modules.course_id > courses.id
Ref: lessons.module_id > modules.id
Ref: quizzes.lesson_id > lessons.id
Ref: quiz_questions.quiz_id > quizzes.id
Ref: quiz_options.question_id > quiz_questions.id
Ref: user_quiz_attempts.user_id > users.id
Ref: user_quiz_attempts.quiz_id > quizzes.id
Ref: discussion_groups.course_id > courses.id
Ref: discussion_threads.group_id > discussion_groups.id
Ref: discussion_threads.user_id > users.id
Ref: discussion_replies.thread_id > discussion_threads.id
Ref: discussion_replies.user_id > users.id
Ref: discussion_replies.parent_reply_id > discussion_replies.id
Ref: announcements.admin_id > users.id
Ref: notifications.recipient_id > users.id
Ref: transactions.user_id > users.id
Ref: transactions.coupon_id > coupons.id
Ref: transactions.admin_bank_account_id > admin_bank_accounts.id
Ref: transaction_details.transaction_id > transactions.id
Ref: transaction_details.course_id > courses.id
Ref: transaction_details.ebook_id > ebooks.id
Ref: enrollments.user_id > users.id
Ref: enrollments.course_id > courses.id
Ref: user_ebook_library.user_id > users.id
Ref: user_ebook_library.ebook_id > ebooks.id
Ref: learning_progress.enrollment_id > enrollments.id
Ref: learning_progress.lesson_id > lessons.id